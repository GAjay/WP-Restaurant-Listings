jQuery(function(e){e(".wp-restaurant-listings-file-upload").each(function(){e(this).fileupload({dataType:"json",dropZone:e(this),url:restaurant_listings_ajax_file_upload.ajax_url.toString().replace("%%endpoint%%","upload_file"),maxNumberOfFiles:1,formData:{script:!0},add:function(t,i){var a=e(this),r=a.closest("form"),n=a.parent().find(".restaurant-listings-uploaded-files"),s=[],l=e(this).data("file_types");if(l){var o=new RegExp("(.|/)("+l+")$","i");i.originalFiles[0].name.length&&!o.test(i.originalFiles[0].name)&&s.push(restaurant_listings_ajax_file_upload.i18n_invalid_file_type+" "+l)}s.length>0?window.alert(s.join("\n")):(r.find(':input[type="submit"]').attr("disabled","disabled"),i.context=e('<progress value="" max="100"></progress>').appendTo(n),i.submit())},progress:function(e,t){var i=parseInt(t.loaded/t.total*100,10);t.context.val(i)},fail:function(t,i){var a=e(this).closest("form");i.errorThrown&&window.alert(i.errorThrown),i.context.remove(),a.find(':input[type="submit"]').removeAttr("disabled")},done:function(t,i){var a=e(this),r=a.closest("form"),n=a.parent().find(".restaurant-listings-uploaded-files"),s=a.attr("multiple")?1:0,l=["jpg","gif","png","jpeg","jpe"];i.context.remove(),void 0===i.result.success||i.result.success||window.alert(i.result.data),e.each(i.result.files,function(t,i){if(i.error)window.alert(i.error);else{var r;e.inArray(i.extension,l)>=0?(r=e.parseHTML(restaurant_listings_ajax_file_upload.js_field_html_img),e(r).find(".restaurant-listings-uploaded-file-preview img").attr("src",i.url)):(r=e.parseHTML(restaurant_listings_ajax_file_upload.js_field_html),e(r).find(".restaurant-listings-uploaded-file-name code").text(i.name)),e(r).find(".input-text").val(i.url),e(r).find(".input-text").attr("name","current_"+a.attr("name")),s?n.append(r):n.html(r)}}),r.find(':input[type="submit"]').removeAttr("disabled")}})})});