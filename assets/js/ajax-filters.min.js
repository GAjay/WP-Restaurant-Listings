jQuery(document).ready(function(a){function t(t,e){if(r){var s=t.find(".restaurant_filters"),n=a(s).serialize(),o=a("div.restaurant_listings").index(t);window.history.replaceState({id:"restaurant_listings_state",page:e,data:n,index:o},"",i+"#s=1")}}var e=[];a(".restaurant_listings").on("update_results",function(t,r,i,s){var n,o,l,d="",_=a(this),c=_.find(".restaurant_filters"),u=_.find(".showing_restaurants"),g=_.find(".restaurant_listings"),p=_.data("per_page"),h=_.data("orderby"),f=_.data("order"),w=_.data("featured"),v=_.data("filled"),m=_.data("restaurant_types"),y=_.data("post_status"),k=a("div.restaurant_listings").index(this);if(!(k<0)){if(e[k]&&e[k].abort(),i||(a(g).addClass("loading"),a("li.restaurant_listings, li.no_restaurant_listings_found",g).css("visibility","hidden"),r>1&&!0!==_.data("show_pagination")?a(g).before('<a class="load_more_restaurants load_previous" href="#"><strong>'+restaurant_listings_ajax_filters.i18n_load_prev_listings+"</strong></a>"):_.find(".load_previous").remove(),_.find(".load_more_restaurants").data("page",r)),!0===_.data("show_filters")){var x=[];a(':input[name="filter_restaurant_type[]"]:checked, :input[name="filter_restaurant_type[]"][type="hidden"], :input[name="filter_restaurant_type"]',c).each(function(){x.push(a(this).val())}),n=c.find(':input[name^="search_categories"]').map(function(){return a(this).val()}).get(),o="",l="",price_range=c.find(':input[name="search_price_range"]').val();var b=c.find(':input[name="search_keywords"]'),j=c.find(':input[name="search_location"]');b.val()!==b.attr("placeholder")&&(o=b.val()),j.val()!==j.attr("placeholder")&&(l=j.val()),d={lang:restaurant_listings_ajax_filters.lang,search_keywords:o,search_location:l,search_categories:n,filter_restaurant_type:x,search_price_range:price_range,filter_post_status:y,per_page:p,orderby:h,order:f,page:r,featured:w,filled:v,show_pagination:_.data("show_pagination"),form_data:c.serialize()}}else n=_.data("categories"),o=_.data("keywords"),l=_.data("location"),price_range=_.data("price_range"),n&&(n=n.split(",")),d={lang:restaurant_listings_ajax_filters.lang,search_categories:n,search_keywords:o,search_location:l,filter_post_status:y,search_price_range:price_range,filter_restaurant_type:m,per_page:p,orderby:h,order:f,page:r,featured:w,filled:v,show_pagination:_.data("show_pagination")};e[k]=a.ajax({type:"POST",url:restaurant_listings_ajax_filters.ajax_url.toString().replace("%%endpoint%%","get_listings"),data:d,success:function(t){if(t)try{t.showing?a(u).show().html("<span>"+t.showing+"</span>"+t.showing_links):a(u).hide(),t.showing_all?a(u).addClass("wp-restaurant-listings-showing-all"):a(u).removeClass("wp-restaurant-listings-showing-all"),t.html&&(i&&s?a(g).prepend(t.html):i?a(g).append(t.html):a(g).html(t.html)),!0===_.data("show_pagination")?(_.find(".restaurant-listings-pagination").remove(),t.pagination&&_.append(t.pagination)):(!t.found_restaurants||t.max_num_pages<=r?a(".load_more_restaurants:not(.load_previous)",_).hide():s||a(".load_more_restaurants",_).show(),a(".load_more_restaurants",_).removeClass("loading"),a("li.restaurant_listings",g).css("visibility","visible")),a(g).removeClass("loading"),_.triggerHandler("updated_results",t)}catch(a){window.console&&window.console.log(a)}},error:function(a,t,e){window.console&&"abort"!==t&&window.console.log(t+": "+e)},statusCode:{404:function(){window.console&&window.console.log("Error 404: Ajax Endpoint cannot be reached. Go to Settings > Permalinks and save to resolve.")}}})}}),a('#search_keywords, #search_location, .restaurant_types :input, #search_categories, .restaurant-listings-filter, input[name="search_price_range"]').change(function(){var e=a(this).closest("div.restaurant_listings");e.triggerHandler("update_results",[1,!1]),t(e,1)}).on("keyup",function(t){13===t.which&&a(this).trigger("change")}),a(".restaurant_filters").on("click",".reset",function(){var e=a(this).closest("div.restaurant_listings"),r=a(this).closest("form");return r.find(':input[name="search_keywords"], :input[name="search_location"], .restaurant-listings-filter').not(':input[type="hidden"]').val("").trigger("chosen:updated"),r.find(':input[name^="search_categories"]').not(':input[type="hidden"]').val(0).trigger("chosen:updated"),a(':input[name="filter_restaurant_type[]"]',r).not(':input[type="hidden"]').attr("checked","checked"),r.find(':input[name="search_price_range"]').val(""),r.find(".price_range_filter li").attr("style",""),e.triggerHandler("reset"),e.triggerHandler("update_results",[1,!1]),t(e,1),!1}),a(document.body).on("click",".load_more_restaurants",function(){var e=a(this).closest("div.restaurant_listings"),r=parseInt(a(this).data("page")||1,10),i=!1;return a(this).addClass("loading"),a(this).is(".load_previous")?(i=!0,1===(r-=1)?a(this).remove():a(this).data("page",r)):(r+=1,a(this).data("page",r),t(e,r)),e.triggerHandler("update_results",[r,!0,i]),!1}),a(".price_range_filter").on("click","li",function(t){a(".price_range_filter li").attr("style","");var e=a(this);a('input[name="search_price_range"]').attr("value",e.attr("data-price_range")),a('input[name="search_price_range"]').triggerHandler("change"),e.css({"background-color":"#c4f3a4",border:"1px solid #41a700",color:"#348c42"})}),a("div.restaurant_listings").on("click",".restaurant-listings-pagination a",function(){var e=a(this).closest("div.restaurant_listings"),r=a(this).data("page");return t(e,r),e.triggerHandler("update_results",[r,!1]),a("body, html").animate({scrollTop:e.offset().top},600),!1}),a.isFunction(a.fn.chosen)&&(1===restaurant_listings_ajax_filters.is_rtl&&a('select[name^="search_categories"]').addClass("chosen-rtl"),a('select[name^="search_categories"]').chosen({search_contains:!0}));var r=!1;window.history&&window.history.pushState&&(r=!0);var i=document.location.href.split("#")[0];a(window).on("load",function(){a(".restaurant_filters").each(function(){var t=a(this).closest("div.restaurant_listings"),e=t.find(".restaurant_filters"),r=1,i=a("div.restaurant_listings").index(t);if(window.history.state&&window.location.hash){var s=window.history.state;s.id&&"restaurant_listings_state"===s.id&&i===s.index&&(r=s.page,e.deserialize(s.data),e.find(':input[name^="search_categories"]').not(':input[type="hidden"]').trigger("chosen:updated"))}t.triggerHandler("update_results",[r,!1])})})});